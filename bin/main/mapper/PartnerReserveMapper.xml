<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="org.workat.workat_project.partner.repository.PartnerReserveMapper">
	
	<select id="getReserveList"
		resultType="org.workat.workat_project.partner.entity.PartnerReserveVO">
		select
			 p.place_id
			 , r.res_id
			 , r.res_name
			 , r.check_in
			 , r.res_cancel_yn
			 ,r.check_out
			 , r.res_message
			 , u.user_tel
			 , room.room_name 
		from
			place p inner join reservation r
		 	on p.place_id = r.place_id
		 	left join `room` room 
		 	on r.room_id = room.room_id   
			left join `user` u 
			on r.user_id = u.user_id 
		where p.user_id  = '1'
	</select>

	<select id="getReserveDetail"
		resultType="org.workat.workat_project.partner.entity.PartnerReserveVO">

		select
			 p.place_id
			 , r.res_id
			 , r.res_name
			 , r.check_in
			 , r.res_cancel_yn
			 ,r.check_out
			 , r.res_message
			 , u.user_tel
			 , room.room_name 
		from
			place p inner join reservation r
		 	on p.place_id = r.place_id
		 	left join `room` room 
		 	on r.room_id = room.room_id   
			left join `user` u 
			on r.user_id = u.user_id 
		where
			 p.user_id  = '1'
		and
			r.res_id = #{res_id}
	</select>

<select id="findAll" resultType="org.workat.workat_project.partner.entity.PartnerReserveVO">
		select	
			 p.place_id
			 , r.res_id
			 , r.res_name
			 , r.check_in
			 , r.res_cancel_yn
			 ,r.check_out
			 , r.res_message
			 , u.user_tel
			 , room.room_name 
		from
			place p inner join reservation r
		 	on p.place_id = r.place_id
		 	left join `room` room 
		 	on r.room_id = room.room_id   
			left join `user` u 
			on r.user_id = u.user_id 
		where
			 p.user_id  = '1'
		limit #{limit}
		offset #{offset}

</select>


<select id="findByNameContaining" resultType="org.workat.workat_project.partner.entity.PartnerReserveVO">
		select	
			 p.place_id
			 , r.res_id
			 , r.res_name
			 , r.check_in
			 , r.res_cancel_yn
			 ,r.check_out
			 , r.res_message
			 , u.user_tel
			 , room.room_name 
		from
			place p inner join reservation r
		 	on p.place_id = r.place_id
		 	left join `room` room 
		 	on r.room_id = room.room_id   
			left join `user` u 
			on r.user_id = u.user_id 
		where 
			p.user_id  = '1'
		AND 
			r.res_name like concat('%', #{search} , '%')
		limit #{limit}
		offset #{offset}

</select>

<select id="count" resultType="int">
		select	
			count(*)
		from
			place p inner join reservation r
		 	on p.place_id = r.place_id
		 	left join `room` room 
		 	on r.room_id = room.room_id   
			left join `user` u 
			on r.user_id = u.user_id 
		where 
			p.user_id  = '1'

</select>


<select id="countByNameContaining" resultType="int">
		select	
			 count(*)
		from
			place p inner join reservation r
		 	on p.place_id = r.place_id
		 	left join `room` room 
		 	on r.room_id = room.room_id   
			left join `user` u 
			on r.user_id = u.user_id 
		where 
			p.user_id  = '1'
		AND 
			r.res_name like concat('%', #{search} , '%')

</select>
	<!-- <update id="updatePlace"
		parameterType="org.workat.workat_project.partner.entity.PartnerPlaceDTO">
		UPDATE 
			place
		SET 
			place_nm = #{place_nm}
			, place_addr = #{place_addr}
			, place_tel = #{place_tel}
			, place_content = #{place_content}
			, place_in = #{place_in}
			, place_out = #{place_out}
			, loc_id = CASE
				WHEN #{loc_nm} = '서울' THEN 1
				WHEN #{loc_nm} = '경기도' THEN 2
				WHEN #{loc_nm} = '강원도' THEN 3
				WHEN #{loc_nm} = '경상도' THEN 4
				WHEN #{loc_nm} = '전라도' THEN 5
				WHEN #{loc_nm} = '충청도' THEN 6
				WHEN #{loc_nm} = '제주도' THEN 7
				ELSE 8 END
		WHERE 
			place_id = #{place_id}
	</update>
 -->
	<!-- <update id="updatePlacepic"
		parameterType="org.workat.workat_project.partner.entity.PartnerPlaceDTO">
		UPDATE place_picture
		SET picture_source = #{picture_source}
		WHERE place_id = #{place_id}
	</update>

	<insert id="insertPlace"
		parameterType="org.workat.workat_project.partner.entity.PartnerPlaceDTO"
		useGeneratedKeys="true" keyColumn="place_id" keyProperty="place_id">
		INSERT INTO place (
			place_nm,
			category,
			place_addr,
			place_tel,
			place_content,
			place_in,
			place_out,
			status,
			loc_id,
			user_id
		) VALUES (
			#{place_nm},
			#{category},
			#{place_addr},
			#{place_tel},
			#{place_content},
			#{place_in},
			#{place_out},
			#{status},
			#{loc_nm},
			'1'
		);
	</insert>

	<insert id="insertPlacepic"
		parameterType="org.workat.workat_project.partner.entity.PartnerPlaceDTO">
		INSERT INTO place_picture (
		picture_source,
		place_id,
		status
		)
		VALUES(#{picture_source}, #{place_id}, #{status});
	</insert>

	<update id="deletePlace">
		UPDATE place
		SET status = 'inactive'
		WHERE place_id = #{place_id}
	</update>

	<update id="deletePlacepic">
		UPDATE place_picture
		SET status = 'inactive'
		WHERE place_id = #{place_id}
	</update>  -->


</mapper>